from typing import List

import requests

from pycricinfo.exceptions import PyCricinfoException

all_ipl_games = [
    1216492,
    1216493,
    1216534,
    1216496,
    1216508,
    1216510,
    1216539,
    1216545,
    1216527,
    1216547,
    1216532,
    1216504,
    1216503,
    1216516,
    1216514,
    1216515,
    1216538,
    1216513,
    1216519,
    1216511,
    1216501,
    1216542,
    1216500,
    1216523,
    1216525,
    1216507,
    1216529,
    1216540,
    1216528,
    1216543,
    1216531,
    1216526,
    1216522,
    1216509,
    1216512,
    1216517,
    1216533,
    1216546,
    1216494,
    1216518,
    1216521,
    1216497,
    1216498,
    1216544,
    1216541,
    1216520,
    1216524,
    1216499,
    1216536,
    1216537,
    1216535,
    1216502,
    1216506,
    1216530,
    1216505,
    1216495,
    1175356,
    1175357,
    1175358,
    1175359,
    1175360,
    1175361,
    1175362,
    1175363,
    1175364,
    1175365,
    1175366,
    1175367,
    1175368,
    1175369,
    1175370,
    1175371,
    1175372,
    1178393,
    1178394,
    1178395,
    1178396,
    1178397,
    1178398,
    1178399,
    1178400,
    1178401,
    1178402,
    1178403,
    1178404,
    1178405,
    1178406,
    1178407,
    1178408,
    1178409,
    1178410,
    1178411,
    1178412,
    1178413,
    1178414,
    1178415,
    1178416,
    1178417,
    1178418,
    1178419,
    1178420,
    1178421,
    1178422,
    1178423,
    1178424,
    1178425,
    1178426,
    1178427,
    1178428,
    1178429,
    1178430,
    1178431,
    1181764,
    1181766,
    1181767,
    1181768,
    1136561,
    1136562,
    1136563,
    1136564,
    1136565,
    1136566,
    1136567,
    1136568,
    1136569,
    1136570,
    1136571,
    1136572,
    1136573,
    1136574,
    1136575,
    1136576,
    1136577,
    1136578,
    1136579,
    1136580,
    1136581,
    1136582,
    1136583,
    1136584,
    1136585,
    1136586,
    1136587,
    1136588,
    1136589,
    1136590,
    1136591,
    1136592,
    1136593,
    1136594,
    1136595,
    1136596,
    1136597,
    1136598,
    1136599,
    1136600,
    1136601,
    1136602,
    1136603,
    1136604,
    1136605,
    1136606,
    1136607,
    1136608,
    1136609,
    1136610,
    1136611,
    1136612,
    1136613,
    1136614,
    1136615,
    1136616,
    1136617,
    1136618,
    1136619,
    1136620,
    1082591,
    1082592,
    1082593,
    1082594,
    1082595,
    1082596,
    1082597,
    1082598,
    1082599,
    1082600,
    1082601,
    1082602,
    1082603,
    1082604,
    1082605,
    1082606,
    1082607,
    1082608,
    1082609,
    1082610,
    1082611,
    1082612,
    1082613,
    1082615,
    1082614,
    1082616,
    1082617,
    1082618,
    1082619,
    1082620,
    1082621,
    1082622,
    1082623,
    1082624,
    1082625,
    1082626,
    1082627,
    1082628,
    1082629,
    1082630,
    1082631,
    1082632,
    1082633,
    1082634,
    1082635,
    1082636,
    1082637,
    1082638,
    1082639,
    1082640,
    1082641,
    1082642,
    1082643,
    1082644,
    1082645,
    1082646,
    1082647,
    1082648,
    1082649,
    1082650,
    980901,
    980903,
    980905,
    980907,
    980909,
    980911,
    980913,
    980915,
    980917,
    980919,
    980921,
    980923,
    980925,
    980927,
    980929,
    980931,
    980933,
    980935,
    980937,
    980939,
    980941,
    980943,
    980945,
    980947,
    980949,
    980951,
    980953,
    980955,
    980957,
    980959,
    980961,
    980963,
    980965,
    980967,
    980969,
    980971,
    980973,
    980975,
    980977,
    980979,
    980981,
    980983,
    980985,
    980987,
    980989,
    980991,
    980993,
    980995,
    980997,
    980999,
    981001,
    981003,
    981005,
    981007,
    981009,
    981011,
    981013,
    981015,
    981017,
    981019,
    829705,
    829707,
    829709,
    829711,
    829713,
    829715,
    829717,
    829719,
    829721,
    829725,
    829727,
    829729,
    829731,
    829733,
    829735,
    829737,
    829739,
    829741,
    829743,
    829745,
    829747,
    829749,
    829751,
    829753,
    829755,
    829757,
    829759,
    829765,
    829763,
    829723,
    829767,
    829769,
    829771,
    829773,
    829775,
    829777,
    829779,
    829781,
    829783,
    829785,
    829787,
    829761,
    829789,
    829791,
    829793,
    829795,
    829797,
    829799,
    829801,
    829803,
    829805,
    829807,
    829809,
    829811,
    829813,
    829815,
    829817,
    829819,
    829821,
    829823,
    729279,
    729281,
    729283,
    729285,
    729287,
    729289,
    729291,
    729293,
    729295,
    729297,
    729299,
    729301,
    729303,
    729305,
    729307,
    729309,
    729311,
    729313,
    729315,
    729317,
    733971,
    733973,
    733975,
    733977,
    733979,
    733981,
    733983,
    733985,
    733987,
    733989,
    733991,
    733993,
    733995,
    733997,
    733999,
    734001,
    734003,
    734005,
    734007,
    734009,
    734011,
    734013,
    734015,
    734017,
    734019,
    734021,
    734023,
    734025,
    734027,
    734029,
    734031,
    734033,
    734035,
    734037,
    734039,
    734041,
    734043,
    734045,
    734047,
    734049,
    597998,
    597999,
    598000,
    598001,
    598002,
    598003,
    598004,
    598005,
    598048,
    598006,
    598007,
    598008,
    598009,
    598010,
    598011,
    598012,
    598013,
    598014,
    598015,
    598016,
    598017,
    598018,
    598019,
    598020,
    598021,
    598022,
    598023,
    598024,
    598025,
    598026,
    598027,
    598059,
    598029,
    598030,
    598031,
    598032,
    598033,
    598034,
    598035,
    598036,
    598037,
    598038,
    598039,
    598040,
    598041,
    598042,
    598043,
    598044,
    598046,
    598047,
    598064,
    598049,
    598050,
    598051,
    598052,
    598053,
    598054,
    598055,
    598056,
    598057,
    598058,
    598060,
    598045,
    598062,
    598061,
    598063,
    598028,
    598065,
    598066,
    598068,
    598067,
    598069,
    598070,
    598071,
    598072,
    598073,
    548306,
    548307,
    548308,
    548309,
    548310,
    548311,
    548312,
    548313,
    548314,
    548315,
    548316,
    548317,
    548318,
    548319,
    548320,
    548322,
    548323,
    548324,
    548325,
    548326,
    548327,
    548328,
    548321,
    548330,
    548331,
    548332,
    548333,
    548334,
    548335,
    548336,
    548337,
    548338,
    548339,
    548340,
    548341,
    548342,
    548343,
    548344,
    548345,
    548346,
    548347,
    548348,
    548349,
    548350,
    548351,
    548352,
    548353,
    548354,
    548355,
    548356,
    548357,
    548358,
    548359,
    548360,
    548329,
    548361,
    548362,
    548363,
    548364,
    548365,
    548366,
    548367,
    548368,
    548369,
    548370,
    548371,
    548372,
    548373,
    548374,
    548375,
    548376,
    548377,
    548378,
    548379,
    548380,
    548381,
    501198,
    501199,
    501200,
    501201,
    501202,
    501203,
    501204,
    501205,
    501206,
    501207,
    501208,
    501209,
    501210,
    501211,
    501212,
    501213,
    501214,
    501215,
    501216,
    501217,
    501218,
    501219,
    501220,
    501222,
    501221,
    501223,
    501224,
    501225,
    501226,
    501227,
    501228,
    501229,
    501230,
    501231,
    501232,
    501233,
    501234,
    501235,
    501236,
    501237,
    501238,
    501239,
    501240,
    501241,
    501242,
    501243,
    501244,
    501245,
    501246,
    501247,
    501248,
    501249,
    501250,
    501251,
    501252,
    501253,
    501254,
    501255,
    501256,
    501257,
    501258,
    501259,
    501260,
    501261,
    501262,
    501263,
    501264,
    501265,
    501266,
    501267,
    501268,
    501269,
    501270,
    501271,
    419106,
    419107,
    419108,
    419109,
    419110,
    419111,
    419112,
    419113,
    419114,
    419115,
    419116,
    419117,
    419118,
    419119,
    419120,
    419121,
    419122,
    419123,
    419124,
    419128,
    419125,
    419126,
    419127,
    419129,
    419130,
    419131,
    419132,
    419133,
    419134,
    419135,
    419136,
    419137,
    419138,
    419139,
    419140,
    419141,
    419142,
    419143,
    419144,
    419145,
    419146,
    419147,
    419148,
    419149,
    419150,
    419151,
    419152,
    419153,
    419154,
    419155,
    419156,
    419157,
    419158,
    419159,
    419160,
    419161,
    419162,
    419163,
    419164,
    419165,
    392181,
    392182,
    392183,
    392184,
    392185,
    392186,
    392187,
    392188,
    392189,
    392190,
    392191,
    392192,
    392193,
    392194,
    392195,
    392196,
    392197,
    392198,
    392199,
    392200,
    392201,
    392202,
    392203,
    392204,
    392205,
    392206,
    392207,
    392208,
    392209,
    392210,
    392211,
    392212,
    392213,
    392214,
    392215,
    392216,
    392217,
    392218,
    392219,
    392220,
    392221,
    392222,
    392223,
    392224,
    392225,
    392226,
    392227,
    392228,
    392229,
    392230,
    392231,
    392232,
    392233,
    392234,
    392235,
    392236,
    392237,
    392238,
    392239,
    335982,
    335983,
    335984,
    335986,
    335985,
    335987,
    335988,
    335989,
    335990,
    335991,
    335993,
    335992,
    335995,
    335994,
    335996,
    335997,
    335998,
    336000,
    335999,
    336001,
    336034,
    336003,
    336004,
    336005,
    336006,
    336007,
    336008,
    336009,
    336010,
    336011,
    336013,
    336014,
    336015,
    336016,
    336017,
    336018,
    336020,
    336021,
    336023,
    336022,
    336025,
    336024,
    336026,
    336027,
    336028,
    336029,
    336030,
    336031,
    336033,
    336032,
    336002,
    336035,
    336036,
    336037,
    336012,
    336019,
    336038,
    336039,
    336040,
]
all_2020_games = [
    1216492,
    1216493,
    1216534,
    1216496,
    1216508,
    1216510,
    1216539,
    1216545,
    1216527,
    1216547,
    1216532,
    1216504,
    1216503,
    1216516,
    1216514,
    1216515,
    1216538,
    1216513,
    1216519,
    1216511,
    1216501,
    1216542,
    1216500,
    1216523,
    1216525,
    1216507,
    1216529,
    1216540,
    1216528,
    1216543,
    1216531,
    1216526,
    1216522,
    1216509,
    1216512,
    1216517,
    1216533,
    1216546,
    1216494,
    1216518,
    1216521,
    1216497,
    1216498,
    1216544,
    1216541,
    1216520,
    1216524,
    1216499,
    1216536,
    1216537,
    1216535,
    1216502,
    1216506,
    1216530,
    1216505,
    1216495,
]


class Series(object):
    """
    Abstraction of a series
    """

    def __init__(self, series_id: int) -> None:

        self.series_id = series_id

        self.json_url = (
            f"http://core.espnuk.org/v2/sports/cricket/leagues/{self.series_id}/"
        )

        self.json = self.get_json()

        # parsing json
        if self.json:
            # need to drill into what this is
            self.name = self.json["name"]
            self.short_name = self.json["shortName"]
            self.abbreviation = self.json["abbreviation"]
            self.slug = self.json["slug"]
            self.is_tournament = self.json["isTournament"]
            self.url = self.json["links"][0]["href"]

    def get_json(self) -> dict:

        r = requests.get(self.json_url)
        # proper exception handling needed

        if r.status_code == 404:
            raise PyCricinfoException
        else:
            return r.json()

    def get_seasons(self) -> List[int]:
        r = requests.get(
            f"http://core.espnuk.org/v2/sports/cricket/leagues/{self.series_id}/seasons/"
        )
        seasons = []
        for season in r.json().get("items"):
            seasons.append(int(season.get("$ref", "").split("/")[-1]))

        return seasons

    def get_season_matches(self, season: int) -> List[int]:
        r = requests.get(
            f"http://core.espnuk.org/v2/sports/cricket/leagues/{self.series_id}/seasons/{season}/events/"
        )
        matches = []
        for m in r.json().get("items"):
            matches.append(int(m.get("$ref", "").split("/")[-1]))

        return matches

    def get_all_matches(self) -> List[int]:
        matches = []
        for season in self.get_seasons():
            for match in self.get_season_matches(season):
                matches.append(match)
        return matches
